<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pomodoro Clock</title>
<style>
  body {
    background: #282c34;
    color: white;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }
  #app {
    background: #20232a;
    padding: 2rem;
    border-radius: 15px;
    width: 320px;
    text-align: center;
  }
  h1 {
    margin-bottom: 1rem;
  }
  .length-control {
    display: flex;
    justify-content: space-around;
    align-items: center;
    margin-bottom: 1rem;
  }
  .length-control > div {
    user-select: none;
  }
  button {
    background: #61dafb;
    border: none;
    color: #20232a;
    font-weight: bold;
    font-size: 1.2rem;
    padding: 0.3rem 0.8rem;
    margin: 0 0.2rem;
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
  }
  button:active {
    background: #21a1f1;
  }
  #timer {
    background: #61dafb;
    color: #20232a;
    border-radius: 10px;
    padding: 1rem 0;
    font-size: 4rem;
    font-weight: bold;
    margin-bottom: 1rem;
    user-select: none;
  }
  #timer-label {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
  }
  #controls {
    display: flex;
    justify-content: center;
  }
  #start_stop, #reset {
    background: #21a1f1;
    margin: 0 0.5rem;
    font-size: 1.2rem;
    padding: 0.6rem 1.2rem;
  }
</style>
</head>
<body>
<div id="app"></div>

<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
  const { useState, useEffect, useRef } = React;

  function PomodoroClock() {
    // States for break and session length in minutes
    const [breakLength, setBreakLength] = useState(5);
    const [sessionLength, setSessionLength] = useState(25);
    // timer in seconds
    const [timeLeft, setTimeLeft] = useState(25 * 60);
    // "Session" or "Break"
    const [timerLabel, setTimerLabel] = useState("Session");
    // Running or paused
    const [isRunning, setIsRunning] = useState(false);

    // Ref for the interval id and audio element
    const intervalRef = useRef(null);
    const beepRef = useRef(null);

    // Format seconds into mm:ss
    const formatTime = (time) => {
      const minutes = Math.floor(time / 60);
      const seconds = time % 60;
      return `${minutes < 10 ? "0" + minutes : minutes}:${
        seconds < 10 ? "0" + seconds : seconds
      }`;
    };

    // Update timeLeft when sessionLength changes (only if timer is not running)
    useEffect(() => {
      if (!isRunning && timerLabel === "Session") {
        setTimeLeft(sessionLength * 60);
      }
    }, [sessionLength, isRunning, timerLabel]);

    // Update timeLeft when breakLength changes (only if timer is not running)
    useEffect(() => {
      if (!isRunning && timerLabel === "Break") {
        setTimeLeft(breakLength * 60);
      }
    }, [breakLength, isRunning, timerLabel]);

    // Timer logic
    useEffect(() => {
      if (isRunning) {
        intervalRef.current = setInterval(() => {
          setTimeLeft((prev) => {
            if (prev === 0) {
              beepRef.current.play();
              if (timerLabel === "Session") {
                setTimerLabel("Break");
                return breakLength * 60;
              } else {
                setTimerLabel("Session");
                return sessionLength * 60;
              }
            }
            return prev - 1;
          });
        }, 1000);
      } else if (!isRunning && intervalRef.current !== null) {
        clearInterval(intervalRef.current);
        intervalRef.current = null;
      }

      return () => {
        if (intervalRef.current !== null) {
          clearInterval(intervalRef.current);
          intervalRef.current = null;
        }
      };
    }, [isRunning, breakLength, sessionLength, timerLabel]);

    // Handlers for increment/decrement with limits 1 to 60
    const handleBreakIncrement = () => {
      if (breakLength < 60 && !isRunning) setBreakLength(breakLength + 1);
    };
    const handleBreakDecrement = () => {
      if (breakLength > 1 && !isRunning) setBreakLength(breakLength - 1);
    };
    const handleSessionIncrement = () => {
      if (sessionLength < 60 && !isRunning) {
        setSessionLength(sessionLength + 1);
      }
    };
    const handleSessionDecrement = () => {
      if (sessionLength > 1 && !isRunning) {
        setSessionLength(sessionLength - 1);
      }
    };

    // Start/stop toggle
    const handleStartStop = () => {
      setIsRunning(!isRunning);
    };

    // Reset everything
    const handleReset = () => {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
        intervalRef.current = null;
      }
      beepRef.current.pause();
      beepRef.current.currentTime = 0;
      setIsRunning(false);
      setBreakLength(5);
      setSessionLength(25);
      setTimerLabel("Session");
      setTimeLeft(25 * 60);
    };

    return (
      <div>
        <h1>Pomodoro Clock</h1>
        <div className="length-control">
          <div id="break-label">
            Break Length
            <div>
              <button id="break-decrement" onClick={handleBreakDecrement}>
                -
              </button>
              <span id="break-length" style={{ margin: "0 15px" }}>
                {breakLength}
              </span>
              <button id="break-increment" onClick={handleBreakIncrement}>
                +
              </button>
            </div>
          </div>

          <div id="session-label">
            Session Length
            <div>
              <button id="session-decrement" onClick={handleSessionDecrement}>
                -
              </button>
              <span id="session-length" style={{ margin: "0 15px" }}>
                {sessionLength}
              </span>
              <button id="session-increment" onClick={handleSessionIncrement}>
                +
              </button>
            </div>
          </div>
        </div>

        <div id="timer">
          <div id="timer-label">{timerLabel}</div>
          <div id="time-left">{formatTime(timeLeft)}</div>
        </div>

        <div id="controls">
          <button id="start_stop" onClick={handleStartStop}>
            {isRunning ? "Pause" : "Start"}
          </button>
          <button id="reset" onClick={handleReset}>
            Reset
          </button>
        </div>

        <audio
          id="beep"
          ref={beepRef}
          src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"
          preload="auto"
        />
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById("app")).render(<PomodoroClock />);
</script>
<script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
</body>
</html>
